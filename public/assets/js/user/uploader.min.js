var myDropzone,totalFiles=0,currentFile=0,queuedFiles=[],uploadedFile=0;function acceptedFormats(){if(null!==sysVars.accepted_files){var e,t,r="";for([e,t]of sysVars.accepted_files.entries())e===sysVars.accepted_files.length-1?r+="."+t:r+=`.${t},`}return r??""}function dropzoneItemTemplate(){var e=document.querySelector(".dropzone .dropzone-previews-inner"),t=(e.id="",e.parentNode.innerHTML);return e.parentNode.removeChild(e),t}function dropzoneInit(){var o=document.querySelector(".dropzone-uploader"),e=acceptedFormats(),t=dropzoneItemTemplate();myDropzone=new Dropzone(".dropzone-uploader",{url:sysVars.upload_url,paramName:"file",previewTemplate:t,addRemoveLinks:!1,autoProcessQueue:!1,uploadMultiple:!1,parallelUploads:1,acceptedFiles:null!==e&&e?e:null,maxFiles:sysVars.max_file_count,maxFilesize:sysVars.max_file_size,withCredentials:!0,previewsContainer:".dropzone-previews",clickable:".dropzone-select",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="token"]').content},init:function(){this.on("sending",function(e,t,r){var o=document.querySelector("#upload-files"),o=(o.classList.add("disabled"),o.disabled=!0,o.querySelector(".spinner-border").classList.remove("d-none"),o.querySelector(".upload-button-text").classList.add("d-none"),document.querySelector(".file-dropdown-add > button"));o.classList.add("disabled"),o.disabled=!0,null!==e.previewElement.querySelector(".output-button")&&r.append("type",e.previewElement.querySelector(".output-button").getAttribute("data-format")),e.previewElement.querySelector(".dropzone-settings").getAttribute("data-form")&&jsonObjectToFormaData(e.previewElement.querySelector(".dropzone-settings").getAttribute("data-form"),r)}),this.on("addedfile",function(e){var t=myDropzone.files.length;if(filesScroll(t),0<t?(document.querySelector(".file-dropdown-add").classList.remove("d-none"),document.querySelector(".upload-files").classList.remove("d-none")):(document.querySelector(".file-dropdown-add").classList.add("d-none"),document.querySelector(".upload-files").classList.add("d-none")),document.querySelector(".dropzone .dropzone-intro").classList.add("d-none"),document.querySelector(".dropzone .dropzone-scroll").classList.remove("d-none"),document.querySelector(".dropzone .dropzone-previews").classList.remove("d-none"),e.previewElement.querySelector(".dropzone-file-info").setAttribute("data-id",generateId()),e.previewElement.querySelector(".dropzone-settings").setAttribute("data-id",generateId()),t>this.options.maxFiles)return this.removeFile(e),toaster(""+langVars.file_max,0),!1;var t=fileNameAndExt(e.name),r=t[0]+"."+t[1];e.upload.filename=r,e.previewElement.querySelector("[data-dz-name]").innerHTML=fileNameShort(t[0])+"."+t[1],e.previewElement.querySelector(".file-extension > span").innerHTML=t[1].toUpperCase(),null!==o.getAttribute("data-modal-bs")?e.previewElement.querySelector(".dropzone-settings").setAttribute("data-bs-target",o.getAttribute("data-modal-bs")):e.previewElement.querySelector(".dropzone-settings").setAttribute("data-bs-target","#settings-modal"),setTimeout(()=>{tooltipHide()},250)}),this.on("removedfile",function(e){null!==e.previewElement.querySelector(".copy-this")&&(uploadedFile-=1,copyButton(e.previewElement.querySelector(".copy-this").getAttribute("data-copy"),"remove")),null!==e.previewElement.querySelector(".download-file-single")&&downloadButton(e.previewElement.querySelector(".download-file-single").getAttribute("data-key"),"remove"),e.previewElement.remove();var t=myDropzone.files.length;filesScroll(t),0<t?(document.querySelector(".file-dropdown-add").classList.remove("d-none"),document.querySelector(".upload-files").classList.remove("d-none"),1==t&&document.querySelectorAll(".file-dropdown-button").forEach(e=>{e.classList.add("d-none")})):(document.querySelector(".file-dropdown-add").classList.add("d-none"),document.querySelector(".upload-files").classList.add("d-none"),document.querySelector(".dropzone .dropzone-scroll").classList.add("d-none"),document.querySelector(".dropzone .dropzone-previews").classList.add("d-none"),document.querySelector(".dropzone .dropzone-intro").classList.remove("d-none"),document.querySelectorAll(".file-dropdown-button").forEach(e=>{e.classList.add("d-none")})),null!==e.previewElement.querySelector(".delete-tooltip")&&bootstrap.Tooltip.getOrCreateInstance(e.previewElement.querySelector(".delete-tooltip")).hide(),setTimeout(()=>{tooltipHide()},250)}),this.on("uploadprogress",function(e,t){o.querySelectorAll(".output-button").forEach(e=>{e.classList.add("disabled"),e.disabled=!0}),o.querySelectorAll(".dropzone-settings").forEach(e=>{e.classList.add("disabled"),e.setAttribute("aria-disabled","true")}),o.querySelectorAll(".dropzone-delete").forEach(e=>{e.classList.add("disabled"),e.setAttribute("aria-disabled","true")});var r=e.previewElement.querySelector(".dropzone-progress-bar");r.classList.remove("d-none"),r.querySelector(".progress > .progress-bar").style.width=t+"%",99<t&&(r.classList.add("d-none"),e.previewElement.querySelector(".dropzone-processing").classList.remove("d-none"))}),this.on("complete",function(e){e.previewElement.querySelector(".dropzone-processing").classList.add("d-none"),null!=queuedFiles[currentFile+=1]&&null!=queuedFiles[currentFile]&&currentFile+1<=totalFiles&&myDropzone.processFile(queuedFiles[currentFile])}),this.on("queuecomplete",function(e,t){var r=document.querySelector(".file-dropdown-add > button"),r=(r.classList.remove("disabled"),r.disabled=!1,document.querySelector("#upload-files"));r.classList.remove("disabled"),r.disabled=!1,r.querySelector(".spinner-border").classList.add("d-none"),r.querySelector(".upload-button-text").classList.remove("d-none"),1<uploadedFile&&document.querySelectorAll(".file-dropdown-button").forEach(e=>{e.classList.remove("d-none")})}),this.on("success",function(r,e){try{if(e.result)dropzoneButtons(r,e.url,e.key),uploadedFile+=1,copyButton(e.url,"add"),downloadButton(e.key,"add");else{if(r.previewElement.querySelector(".dropzone-delete").classList.remove("disabled"),r.previewElement.querySelector(".dropzone-delete").setAttribute("aria-disabled","false"),e.errors){var o=Object.values(e.errors),a=document.createElement("div");let t="";o.forEach(e=>{t+=`<div>
                                    <i class="fa-solid fa-triangle-exclamation"></i>
                                    <span data-dz-errormessage>${e}</span>
                                </div>`}),a.innerHTML=t,(n=r.previewElement.querySelector(".dropzone-error")).innerHTML="",n.append(a)}else(n=r.previewElement.querySelector(".dropzone-error")).innerHTML=e.data;n.classList.remove("d-none")}}catch(e){var n;console.log(e),(n=r.previewElement.querySelector(".dropzone-error")).innerHTML=langVars.error,n.classList.remove("d-none")}}),this.on("error",function(e,t){var e=e.previewElement,r=e.querySelector(".dropzone-error");r.innerHTML=void 0!==t.message?t.message:t,r.classList.remove("d-none"),null!==e.querySelector(".dropzone-output")&&e.querySelector(".dropzone-output").remove(),null!==e.querySelector(".dropzone-settings")&&e.querySelector(".dropzone-settings").remove(),null!==e.querySelector(".dropzone-delete")&&(e.querySelector(".dropzone-delete").classList.remove("disabled"),e.querySelector(".dropzone-delete").setAttribute("aria-disabled","false"))})}})}function addFileUrl(){var o=document.querySelector("#add-file-url-form input"),a=(o.classList.remove("missing"),o.readOnly=!0,document.querySelector("#add-file-url-form button")),n=(a.disabled=!0,a.querySelector(".spinner-border").classList.remove("d-none"),o.parentElement.parentElement.querySelector(".url-input-error"));n.classList.add("d-none"),n.innerHTML="",n.classList.remove("dropzone-error");let l=new XMLHttpRequest;l.open("POST",document.querySelector("#add-file-url-form").action,!0),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="token"]').content),l.addEventListener("error",()=>{toaster(langVars.error,0)}),l.addEventListener("abort",()=>{toaster(langVars.cancelled,0)}),l.addEventListener("load",()=>{if(l.readyState===XMLHttpRequest.DONE&&200===l.status){var e,t,r=JSON.parse(l.responseText);if(r.result)n.classList.remove("dropzone-error"),dropzoneAddFile(o,r.fileName,r.fileUrl);else if(o.readOnly=!1,a.disabled=!1,a.querySelector(".spinner-border").classList.add("d-none"),o.classList.add("missing"),r.errors)for([e,t]of Object.entries(r.errors))n.innerHTML=t,n.classList.remove("dropzone-success"),n.classList.add("dropzone-error"),n.classList.remove("d-none");else n.innerHTML=r.data,n.classList.remove("dropzone-success"),n.classList.add("dropzone-error"),n.classList.remove("d-none")}else toaster(langVars.error,0)});var e=new FormData;e.append(o.name,o.value),l.send(e)}function downloadAll(e,t){let o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="token"]').content),o.addEventListener("error",()=>{toaster(langVars.error,0)}),o.addEventListener("abort",()=>{toaster(langVars.cancelled,0)}),o.addEventListener("load",()=>{var e,t,r;document.querySelector(".file-dropdown-download .spinner-border").classList.add("d-none"),document.querySelector(".file-dropdown-download").disabled=!1,o.readyState===XMLHttpRequest.DONE&&200===o.status?(e=JSON.parse(o.responseText)).result?(t=e.data,(r=document.createElement("a")).href=t,r.setAttribute("download",""),document.body.appendChild(r),r.click()):toaster(e.data,0):toaster(langVars.error,0)});e=new FormData;e.append("keys",t),o.send(e)}function downloadSingle(o,e,t){let a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="token"]').content),a.addEventListener("error",()=>{toaster(langVars.error,0)}),a.addEventListener("abort",()=>{toaster(langVars.cancelled,0)}),a.addEventListener("load",()=>{var e,t,r;o.querySelector(".spinner-border").classList.add("d-none"),o.querySelector("i").classList.remove("d-none"),o.disabled=!1,a.readyState===XMLHttpRequest.DONE&&200===a.status?(e=JSON.parse(a.responseText)).result?(t=e.data,(r=document.createElement("a")).href=t,r.setAttribute("download",""),document.body.appendChild(r),r.click()):toaster(e.data,0):toaster(langVars.error,0)});e=new FormData;e.append("keys",t),a.send(e)}function dropzoneButtons(e,t,r){var o=document.createElement("div"),t=(o.classList.add("d-flex","gap-1","gap-md-2","align-items-center","justify-content-sm-end","flex-wrap","flex-sm-nowrap"),o.innerHTML=`<a 
        href="${t}" 
        class="open-file result-button btn px-3" 
        target="_blank">
        Open
    </a>
    <a href="#" class="copy-this" data-copy="${t}" aria-label="Copy">
        <span 
            class="result-button"
            data-bs-toggle="tooltip" data-bs-placement="top" 
            data-bs-custom-class="custom-tooltip" data-bs-title="Copy" 
            data-bs-trigger="hover">
            <i class="fa-regular fa-copy fa-lg pe-none"></i>
        </span>
    </a>
    <a href="#" class="download-file-single" data-key="${r}">
        <span 
            class="result-button"
            data-bs-toggle="tooltip" data-bs-placement="top" 
            data-bs-custom-class="custom-tooltip" data-bs-title="Download" 
            data-bs-trigger="hover">
            <i class="fa-regular fa-circle-down fa-lg pe-none"></i>
            <span class="spinner-border spinner-border-sm pe-none d-none" 
                role="status"></span>
        </span>
    </a>
    <a href="#" class="clear-file" data-file-id="${e.upload.uuid}">
            <span 
                class="result-button delete-tooltip"
                data-bs-toggle="tooltip" data-bs-placement="top" 
                data-bs-custom-class="custom-tooltip" data-bs-title="Clear" 
                data-bs-trigger="hover">
            <i class="fa-regular fa-circle-xmark fa-lg pe-none"></i>
        </span>
    </a>`,e.previewElement.querySelector(".dropzone-toolbar"));t.innerHTML="",t.append(o),tooltipInit()}function dropzoneAddFile(o,a,e){var o=document.querySelector("#add-file-url-form input"),n=document.querySelector("#add-file-url-form button");let l=new XMLHttpRequest;l.open("POST","/fetch-file",!0),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="token"]').content),l.addEventListener("error",()=>{toaster(langVars.error,0)}),l.addEventListener("abort",()=>{toaster(langVars.cancelled,0)}),l.addEventListener("load",()=>{var e,t,r;o.readOnly=!1,n.disabled=!1,n.querySelector(".spinner-border").classList.add("d-none"),l.readyState===XMLHttpRequest.DONE&&200===l.status?(e=JSON.parse(l.responseText)).result?(t=base64ToBlob(e.file),t=new File(t,a,{type:e.mime}),myDropzone.addFile(t),(r=o.parentElement.parentElement.querySelector(".url-input-error")).innerHTML=e.data,r.classList.add("dropzone-success"),r.classList.remove("d-none"),o.value="",setTimeout(()=>{closeUrlModel()},750),setTimeout(()=>{r.innerHTML=""},1250)):((r=o.parentElement.parentElement.querySelector(".url-input-error")).innerHTML=`${e.data} (Error:${e.error})`,r.classList.add("dropzone-error"),r.classList.remove("d-none")):toaster(langVars.error,0)});var t=new FormData;t.append("url",e),l.send(t)}function closeUrlModel(){bootstrap.Modal.getOrCreateInstance(document.querySelector("#from-link-modal")).hide()}function generateId(){let t="";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=r.length;for(let e=0;e<16;e++)t+=r.charAt(Math.floor(Math.random()*o));return t}function getViewport(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0);return e<=575.98?"xs":576<=e&&e<=767.98?"sm":768<=e&&e<=991.98?"md":992<=e&&e<=1199.98?"lg":1200<=e&&e<=1399.98?"xl":"xxl"}function copyButton(e,t){var r,o,a;if("add"==t)n=(o=(r=document.querySelector(".file-dropdown-copy")).getAttribute("data-copy"))?((a=o.split(",")).push(e),a.toString()):e,r.setAttribute("data-copy",n);else if("remove"==t){removeFromArr(a=(o=(r=document.querySelector(".file-dropdown-copy")).getAttribute("data-copy")).split(","),e);for(let e=a.length-1;0<=e;e--)a[e]||a.splice(e,1);var n=a.toString();r.setAttribute("data-copy",n)}return!0}function downloadButton(e,t){var r,o,a;if("add"==t)n=(o=(r=document.querySelector(".file-dropdown-download")).getAttribute("data-keys"))?((a=o.split(",")).push(e),a.toString()):e,r.setAttribute("data-keys",n);else if("remove"==t){removeFromArr(a=(o=(r=document.querySelector(".file-dropdown-download")).getAttribute("data-keys")).split(","),e);for(let e=a.length-1;0<=e;e--)a[e]||a.splice(e,1);var n=a.toString();r.setAttribute("data-keys",n)}return!0}function removeFromArr(r,o){return r.forEach((e,t)=>{e===o&&r.splice(t,1)}),r}function dropdownScroll(e){e=e.querySelector(".output-dropdown-list");e.style.height="127px",OverlayScrollbars(e,{overflow:{x:"hidden",y:"scroll"},scrollbars:{autoHide:"never"}})}function filesScroll(e){var t,r=document.querySelector(".dropzone-scroll");3<e?(r.style.height=132*(3<e?3:e)+"px",t=OverlayScrollbars(r,{overflow:{x:"hidden",y:"scroll"},scrollbars:{autoHide:"never"}}),r.classList.add("pe-3")):(void 0!==t&&t.update(),r.style.height="auto",r.classList.remove("pe-3"))}function base64ToBlob(e,t=0,r=512){var o=atob(e.split(",")[1]),a=[];for(let e=0;e<o.length;e+=r){var n=o.slice(e,e+r),l=new Array(n.length);for(let e=0;e<n.length;e++)l[e]=n.charCodeAt(e);var s=new Uint8Array(l);a.push(s)}return a}function serialize(e){var t,r,o={};for([t,r]of e)void 0!==o[t]?(Array.isArray(o[t])||(o[t]=[o[t]]),o[t].push(r)):o[t]=r;return o}document.addEventListener("click",function(e){var t,r,o,a,n,l;if(e.target.matches("#upload-files")&&(0<(queuedFiles=myDropzone.getQueuedFiles()).length?(totalFiles=queuedFiles.length,currentFile=0,null!==document.querySelectorAll(".dz-remove")&&document.querySelectorAll(".dz-remove").forEach(e=>{e.remove()}),setTimeout(function(){myDropzone.processFile(queuedFiles[currentFile])},250)):toaster(langVars.no_file_selected,0)),e.target.matches("[data-modal]")&&(t=e.target.getAttribute("data-modal"),new bootstrap.Modal("#"+t,{keyboard:!1,backdrop:"static"}).toggle()),e.target.matches(".modal-cancel")&&null!==e.target.getAttribute("data-modal-id")&&(d=e.target.getAttribute("data-modal-id"),(s=document.querySelector("#"+d)).querySelectorAll("input").forEach(e=>{e.value=""}),s.querySelectorAll("select").forEach(e=>{e.selectedIndex=0}),o=(a=document.querySelector(".save-settings")).getAttribute("data-id"),a=a.getAttribute("data-current-form"),n=document.querySelector(`.dropzone-settings[data-id="${o}"]`),l=serialize(l=new FormData(document.querySelector(a))),n)&&n.setAttribute("data-form",JSON.stringify(l)),e.target.matches(".copy-this > span")&&(e.preventDefault(),copyThis(e.target.parentElement.getAttribute("data-copy")),setTimeout(()=>{tooltipHide()},250)),e.target.matches(".file-dropdown-download")&&(e.preventDefault(),e.target.querySelector(".spinner-border").classList.remove("d-none"),e.target.disabled=!0,downloadAll(e.target.getAttribute("data-action-zip"),e.target.getAttribute("data-keys"))),e.target.matches(".download-file-single")&&(e.preventDefault(),e.target.querySelector("i").classList.add("d-none"),e.target.querySelector(".spinner-border").classList.remove("d-none"),e.target.disabled=!0,u=document.querySelector(".file-dropdown-download").getAttribute("data-action"),downloadSingle(e.target,u,e.target.getAttribute("data-key")),setTimeout(()=>{tooltipHide()},250)),e.target.matches(".download-file-single > span")&&(e.preventDefault(),e.target.querySelector("i").classList.add("d-none"),e.target.parentElement.querySelector(".spinner-border").classList.remove("d-none"),e.target.parentElement.disabled=!0,u=document.querySelector(".file-dropdown-download").getAttribute("data-action"),downloadSingle(e.target.parentElement,u,e.target.parentElement.getAttribute("data-key")),setTimeout(()=>{tooltipHide()},250)),e.target.matches(".clear-file")&&(e.preventDefault(),i=myDropzone.files,t=e.target.getAttribute("data-file-id"),i.forEach(e=>{e.upload.uuid==t&&myDropzone.removeFile(e)}),setTimeout(()=>{tooltipHide()},250)),e.target.matches(".clear-file > span")&&(e.preventDefault(),i=myDropzone.files,t=e.target.parentElement.getAttribute("data-file-id"),i.forEach(e=>{e.upload.uuid==t&&myDropzone.removeFile(e)}),setTimeout(()=>{tooltipHide()},250)),e.target.matches(".output-dropdown-item")&&(e.preventDefault(),r=e.target.getAttribute("data-format"),u=e.target.closest(".dropzone-output-selector").querySelector(".output-button"))&&0<r.length&&(u.setAttribute("data-format",r),u.innerHTML=r),e.target.matches(".dropzone-settings > span")){var s,d=e.target.parentElement.getAttribute("data-bs-target"),i=((s=document.querySelector(d)).querySelector(".save-settings").setAttribute("data-id",e.target.parentElement.getAttribute("data-id")),e.target.parentElement.getAttribute("data-form"));if(null!==i){var u=JSON.parse(i);for(let[e,t]of Object.entries(u))null!==s.querySelector(`input[name="${e}"]`)&&(s.querySelector(`input[name="${e}"]`).value=t),null!==s.querySelector(`select[name="${e}"]`)&&(s.querySelector(`select[name="${e}"]`).value=t)}}e.target.matches(".save-settings")&&(o=e.target.getAttribute("data-id"),a=e.target.getAttribute("data-current-form"),n=document.querySelector(`.dropzone-settings[data-id="${o}"]`),l=serialize(l=new FormData(document.querySelector(a))),n)&&n.setAttribute("data-form",JSON.stringify(l))}),document.addEventListener("submit",function(e){e.target.matches("#file-upload-form")&&e.preventDefault(),e.target.matches("#add-file-url-form")&&(e.preventDefault(),addFileUrl())}),document.addEventListener("paste",function(e){var t,e=(e.clipboardData||e.originalEvent.clipboardData).items;for(t of Object.values(e))"file"===t.kind&&myDropzone.addFile(t.getAsFile())}),document.addEventListener("show.bs.modal",function(e){e.target.matches("#settings-modal")&&setTimeout(()=>{tooltipHide()},250)}),document.addEventListener("hidden.bs.modal",function(e){var t,r,o;e.target.matches("#from-link-modal")&&(t=document.querySelector("#add-file-url-form input"),r=document.querySelector("#add-file-url-form button"),o=document.querySelector("#add-file-url-form .url-input-error"),t.classList.remove("missing"),t.readOnly=!1,t.value="",r.disabled=!1,r.querySelector(".spinner-border").classList.add("d-none"),o.classList.add("d-none"),o.innerHTML=""),e.target.matches("#settings-modal")&&document.querySelector("#settings-form").reset()}),Dropzone.autoDiscover=!1;let jsonObjectToFormaData=(e,t)=>(convertRecursively(JSON.parse(e),t),t),convertRecursively=(t,r,o="")=>{var e;Array.isArray(t)?t.forEach(e=>convertRecursively(e,r,o)):t instanceof File?r.append(o,t):t instanceof Date?r.append(o,t.toISOString()):!(t instanceof Object)||t instanceof File||t instanceof Blob||t instanceof Date?(e=null==t?"":t.toString(),r.append(o,e)):Object.keys(t).forEach(e=>convertRecursively(t[e],r,o?o+`[${e}]`:e))};function fileNameAndExt(e){var t=e.lastIndexOf(".");return[e.slice(0,t),e.slice(t+1).toLowerCase()]}function fileNameShort(e){var t=e.length;return 6<t?e.substring(0,3)+"..."+e.substring(t-3):e}function tooltipHide(){null!==document.querySelector('[data-bs-toggle="tooltip"]')&&document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(e=>{bootstrap.Tooltip.getOrCreateInstance(e).hide()})}